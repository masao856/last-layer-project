
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Last Layer - UI完全統合版</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #000; color: #fff; }
    #backgroundContainer { width: 100%; height: 220px; background-size: cover; background-position: center; }
    #enemyImage { max-height: 160px; margin: 10px auto; display: block; }
    #log { background: #222; padding: 10px; height: 120px; overflow-y: auto; font-size: 0.9em; margin: 0 10px; }
    .button-group { margin: 10px; }
    button { margin: 4px; }
    .status-block, .party-block { padding: 10px; margin: 10px; background: #111; border: 1px solid #444; }
    .party-member { display: inline-block; width: 30%; vertical-align: top; padding: 4px; }
    .bar { height: 10px; background: #444; margin: 4px 0; }
    .bar-inner { height: 10px; background: lime; }
    #inventory { padding: 4px 10px; font-size: 0.9em; }
    #skillMenu { display: none; padding: 6px 10px; background: #111; border-top: 1px solid #444; }
    .status-labels { font-size: 0.8em; color: #f88; }
  </style>
</head>
<body>

<div id="backgroundContainer"></div>
<img id="enemyImage" src="" alt="敵画像">

<div class="status-block">
  <strong>プレイヤー：勇者</strong>
  <div>HP: <span id="playerHp">100</span> / MP: <span id="playerMp">50</span></div>
  <div class="bar"><div id="playerHpBar" class="bar-inner" style="width: 100%;"></div></div>
  <div class="bar" style="background:#335;"><div id="playerMpBar" class="bar-inner" style="width: 100%; background: #66f;"></div></div>
  <div class="status-labels" id="playerStatus">状態異常: なし</div>
</div>

<div class="party-block">
  <strong>仲間</strong><br>
  <div class="party-member">戦士<br>HP: 100<br>MP: 20</div>
  <div class="party-member">魔法使い<br>HP: 80<br>MP: 60</div>
</div>

<div class="button-group">
  <button onclick="attack()">攻撃</button>
  <button onclick="toggleSkillMenu()">スキル</button>
  <button onclick="defend()">防御</button>
  <button onclick="useItem()">アイテム</button>
</div>

<div id="skillMenu">
  スキル選択：
  <select id="skillSelect">
    <option value="fireball">ファイアボール</option>
    <option value="heal">ヒール</option>
    <option value="paralyze">パラライズ</option>
  </select>
  <button onclick="castSkill()">使う</button>
</div>

<div class="button-group">
  <button onclick="goForward()">進む</button>
  <button onclick="goBack()">戻る</button>
</div>

<div class="status-block">
  <strong>所持アイテム</strong>
  <div id="inventory">ポーション ×2</div>
</div>

<div id="log"></div>

<script>
let player = {
  hp: 100,
  maxHp: 100,
  mp: 50,
  maxMp: 50,
  status: "なし",
  inventory: ["ポーション", "ポーション"]
};

function updateStatusUI() {
  document.getElementById("playerHp").textContent = player.hp;
  document.getElementById("playerMp").textContent = player.mp;
  document.getElementById("playerHpBar").style.width = (player.hp / player.maxHp * 100) + "%";
  document.getElementById("playerMpBar").style.width = (player.mp / player.maxMp * 100) + "%";
  document.getElementById("playerStatus").textContent = "状態異常: " + player.status;
  document.getElementById("inventory").textContent = player.inventory.join(" × ") || "なし";
}

function logMsg(msg) {
  const div = document.createElement("div");
  div.textContent = msg;
  document.getElementById("log").appendChild(div);
  document.getElementById("log").scrollTop = document.getElementById("log").scrollHeight;
}

function attack() {
  logMsg("勇者の攻撃！敵に10ダメージ！");
}

function defend() {
  logMsg("勇者は防御の構えをとった！");
}

function toggleSkillMenu() {
  const menu = document.getElementById("skillMenu");
  menu.style.display = menu.style.display === "none" ? "block" : "none";
}

function castSkill() {
  const skill = document.getElementById("skillSelect").value;
  if (skill === "fireball") {
    player.mp -= 10;
    logMsg("ファイアボール発動！敵に20ダメージ！");
  } else if (skill === "heal") {
    player.mp -= 5;
    const heal = 20;
    player.hp = Math.min(player.maxHp, player.hp + heal);
    logMsg("ヒール発動！HPが" + heal + "回復！");
  } else if (skill === "paralyze") {
    player.mp -= 8;
    logMsg("パラライズ発動！敵をまひさせた！");
  }
  updateStatusUI();
  toggleSkillMenu();
}

function useItem() {
  const idx = player.inventory.indexOf("ポーション");
  if (idx !== -1) {
    player.hp = Math.min(player.maxHp, player.hp + 30);
    player.inventory.splice(idx, 1);
    logMsg("ポーションを使った。HPが30回復！");
  } else {
    logMsg("ポーションがない！");
  }
  updateStatusUI();
}

let currentDistance = 0;
function goForward() {
  currentDistance += 50;
  logMsg("進んだ！（" + currentDistance + "m）");
}
function goBack() {
  currentDistance = Math.max(0, currentDistance - 50);
  logMsg("戻った！（" + currentDistance + "m）");
}

updateStatusUI();
</script>
</body>
</html>
